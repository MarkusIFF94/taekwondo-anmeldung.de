<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beitrittserklärung - Taekwondo</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init({
                publicKey: "TZqUF7Zd3ljeam8VC", // Hier deinen Public Key von EmailJS einfügen
            });
        })();
    </script>
    <style>
        #signature-pad {
            border: 1px solid #000;
            width: 300px;
            height: 150px;
        }
    </style>
</head>
<body>
    <h1>Beitrittserklärung - Abteilung Taekwondo</h1>
    <p>Hiermit erkläre ich meinen Beitritt zur Abteilung Taekwondo des TuS Blau-Weiß Lohne und stimme der Speicherung meiner personenbezogenen Daten durch die Bestätigung des Absende Buttons zu.</p>
    <p>Bitte füllen Sie dieses Formular online aus. Die Daten werden an die E-Mail Adresse <strong>taekwondo@bw-lohne.de</strong> versendet und überprüft.</p>

    <form id="contact-form">
        <h2>Persönliche Daten</h2>
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required><br><br>

        <label for="vorname">Vorname:</label><br>
        <input type="text" id="vorname" name="vorname" required><br><br>

        <label for="plz">PLZ:</label><br>
        <input type="text" id="plz" name="plz" required><br><br>

        <label for="wohnort">Wohnort:</label><br>
        <input type="text" id="wohnort" name="wohnort" required><br><br>

        <label for="strasse">Straße:</label><br>
        <input type="text" id="strasse" name="strasse" required><br><br>

        <label for="geburtsort">Geburtsort:</label><br>
        <input type="text" id="geburtsort" name="geburtsort" required><br><br>

        <label for="geburtsdatum">Geburtsdatum:</label><br>
        <input type="date" id="geburtsdatum" name="geburtsdatum" required><br><br>

        <label for="nationalitaet">Nationalität:</label><br>
        <input type="text" id="nationalitaet" name="nationalitaet" required><br><br>

        <label for="mobil">Mobiltelefon:</label><br>
        <input type="text" id="mobil" name="mobil" required><br><br>

        <label for="email">E-Mail:</label><br>
        <input type="email" id="email" name="email" required><br><br>

        <label for="erziehungsberechtigter">Name Erziehungsberechtigter (falls minderjährig):</label><br>
        <input type="text" id="erziehungsberechtigter" name="erziehungsberechtigter"><br><br>

        <h2>Mitgliedsbeiträge</h2>
        <p>Mitgliedsbeiträge werden halbjährlich im Lastschriftverfahren eingezogen:</p>
        <input type="radio" id="kinder" name="mitgliedsbeitrag" value="kinder">
        <label for="kinder">Kinder und Jugendliche bis 18: 60 €</label><br>
        <input type="radio" id="erwachsene" name="mitgliedsbeitrag" value="erwachsene">
        <label for="erwachsene">Erwachsene: 90 €</label><br>
        <input type="radio" id="familienmitglied" name="mitgliedsbeitrag" value="familienmitglied">
        <label for="familienmitglied">Ab dem 3. direkten Familienmitglied im Verein: Beitragsfrei</label><br><br>

        <p>Zusätzlich ist für jeden Beitretenden eine einmalige Gebühr in Höhe von 25 € in bar für den Pass zu entrichten.</p>

        <label for="namen_familienmitglieder">Namen der Familienmitglieder (falls zutreffend):</label><br>
        <input type="text" id="namen_familienmitglieder" name="namen_familienmitglieder"><br><br>

        <h2>Einzugsermächtigung</h2>
        <label for="kontoinhaber">Kontoinhaber:</label><br>
        <input type="text" id="kontoinhaber" name="kontoinhaber" required><br><br>

        <label for="kreditinstitut">Kreditinstitut:</label><br>
        <input type="text" id="kreditinstitut" name="kreditinstitut" required><br><br>

        <label for="iban">IBAN:</label><br>
        <input type="text" id="iban" name="iban" required><br><br>

        <label for="bic">BIC:</label><br>
        <input type="text" id="bic" name="bic" required><br><br>

        <p>Kontoverbindung Blau-Weiß Lohne Abteilung Taekwondo: IBAN: <strong>DE24 2805 0100 0072 2248 50</strong>, BIC: <strong>SLZODE22XXX</strong></p>

        <!-- Profilbild-Upload -->
        <label for="Passbild">Profilbild hochladen (max. 40KB) (nur .jpg, .jpeg, .png):</label><br>
        <input type="file" id="Passbild" name="Passbild" accept="image/jpeg, image/jpg, image/png" required><br><br>

        <h2>Unterschrift</h2>
        <p>Bitte unterschreiben Sie unten:</p>
        <canvas id="signature-pad"></canvas><br>
        <button type="button" id="clear-btn">Unterschrift löschen</button><br><br>

        <input type="submit" value="Absenden">
    </form>

    <script type="text/javascript">
        const canvas = document.getElementById('signature-pad');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        // Unterschrift starten
        canvas.addEventListener('mousedown', (event) => {
            drawing = true;
            ctx.beginPath();
            ctx.moveTo(event.offsetX, event.offsetY);
        });

        // Unterschrift zeichnen
        canvas.addEventListener('mousemove', (event) => {
            if (drawing) {
                ctx.lineTo(event.offsetX, event.offsetY);
                ctx.stroke();
            }
        });

        // Unterschrift beenden
        canvas.addEventListener('mouseup', () => {
            drawing = false;
        });

        // Unterschrift löschen
        document.getElementById('clear-btn').addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        document.getElementById('contact-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Verhindert das Neuladen der Seite

            const fileInput = document.getElementById('Passbild');
            const file = fileInput.files[0];

            // Überprüfe die Dateigröße (max. 40 KB)
            if (file.size > 40 * 1024) { // 40 KB in Bytes
                alert('Das Bild darf maximal 40 KB groß sein.');
                return; // Stoppe die Ausführung
            }

            const reader = new FileReader();
            reader.onload = function() {
                const base64Image = reader.result; // Bild als Base64

                // Unterschrift als Base64-Bild
                const signature = canvas.toDataURL('image/png');

                const message = `
                    Name: ${document.getElementById('name').value}
                    Vorname: ${document.getElementById('vorname').value}
                    PLZ: ${document.getElementById('plz').value}
                    Wohnort: ${document.getElementById('wohnort').value}
                    Straße: ${document.getElementById('strasse').value}
                    Geburtsort: ${document.getElementById('geburtsort').value}
                    Geburtsdatum: ${document.getElementById('geburtsdatum').value}
                    Nationalität: ${document.getElementById('nationalitaet').value}
                    Mobiltelefon: ${document.getElementById('mobil').value}
                    E-Mail: ${document.getElementById('email').value}
                    Erziehungsberechtigter: ${document.getElementById('erziehungsberechtigter').value}
                    Mitgliedsbeitrag: ${document.querySelector('input[name="mitgliedsbeitrag"]:checked')?.value}
                    Namen der Familienmitglieder: ${document.getElementById('namen_familienmitglieder').value}
                    Kontoinhaber: ${document.getElementById('kontoinhaber').value}
                    Kreditinstitut: ${document.getElementById('kreditinstitut').value}
                    IBAN: ${document.getElementById('iban').value}
                    BIC: ${document.getElementById('bic').value}
                `;

                const passbild = `
					Passbild:
                	<img src="${base64Image}" alt="Profilbild" style="max-width: 150px;" /> <!-- Bild wird hier eingefügt -->
                `;

                const unterschrift = `
					Unterschrift:
                	<img src="${signature}" alt="Unterschrift" style="max-width: 300px;" />
                `;

                // Sende die Nachricht an EmailJS
                emailjs.send('service_l9dmwtz', 'template_dfr5rkp', { message: message, passbild: passbild, unterschrift: unterschrift })
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    alert('E-Mail erfolgreich gesendet!');
                }, function(error) {
                    console.log('FAILED...', error);
                    alert('Es gab ein Problem beim Senden der Nachricht.');
                });
            };

            reader.readAsDataURL(file); // Bild in Base64 konvertieren
        });
    </script>
</body>
</html>
